<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Robot Crosser</title>
  <style>
    body {
      margin: 0;
      background: #0b0f1a;
      color: #fff;
      font-family: system-ui, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      background: #111827;
      border: 2px solid #3b82f6;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
<canvas id="game" width="400" height="400"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const TILE = 40;
const ROWS = 10;
const COLS = 10;
const MAX_LEVEL = 3;

let level = 1;
let lives = 3;
let state = 'play'; // play | transition | celebrate | gameover

const robot = { x: 4, y: 9 };
const cars = [];
const rainDrops = [];

const levelThemes = [
  { road: '#1f2937', car: '#ef4444', goal: '#16a34a' },
  { road: '#2e1065', car: '#f97316', goal: '#22c55e' },
  { road: '#0f172a', car: '#38bdf8', goal: '#a3e635' },
];

function theme() { return levelThemes[(level - 1) % levelThemes.length]; }

function spawnCars() {
  cars.length = 0;
  for (let row = 2; row <= 7; row += 2) {
    for (let i = 0; i < 3; i++) {
      cars.push({
        row,
        x: Math.random() * COLS,
        speed: (Math.random() * 0.03 + 0.02) * (row % 4 === 0 ? 1 : -1)
      });
    }
  }
}

function resetRobot() { robot.x = 4; robot.y = 9; }

function loseLife() {
  lives--;
  resetRobot();
  if (lives <= 0) {
    state = 'gameover';
    spawnRain();
  }
}

function completeLevel() {
  state = 'transition';
  setTimeout(() => {
    if (level < MAX_LEVEL) {
      level++;
      spawnCars();
      resetRobot();
      state = 'play';
    } else {
      state = 'celebrate';
    }
  }, 1000);
}

spawnCars();

// Gnome drawing function
function drawGnome(sad = false) {
  ctx.save();
  ctx.translate(robot.x * TILE + TILE/2, robot.y * TILE + TILE/2);

  // Head
  ctx.fillStyle = '#facc15';
  ctx.fillRect(-12, -16, 24, 24);

  // Red spot
  ctx.fillStyle = '#ff0000';
  ctx.fillRect(-2, -16, 4, 4);

  // Body
  ctx.fillStyle = '#c0c0c0';
  ctx.fillRect(-12, -4, 24, 28);

  // Mouth
  if (sad) {
    ctx.beginPath();
    ctx.arc(0, 14, 4, 0, Math.PI, true); // upside-down semicircle
    ctx.strokeStyle = '#ffffff';
    ctx.lineWidth = 2;
    ctx.stroke();
  } else {
    ctx.fillStyle = '#000000';
    ctx.fillRect(-4, 12, 8, 2); // normal straight mouth
  }

  ctx.restore();
}

function spawnRain() {
  rainDrops.length = 0;
  for (let i = 0; i < 50; i++) {
    rainDrops.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, speed: 2 + Math.random() * 2 });
  }
}

function drawRain() {
  ctx.strokeStyle = '#3b82f6';
  ctx.lineWidth = 1;
  rainDrops.forEach(drop => {
    ctx.beginPath();
    ctx.moveTo(drop.x, drop.y);
    ctx.lineTo(drop.x, drop.y + 5);
    ctx.stroke();
    drop.y += drop.speed;
    if (drop.y > canvas.height) drop.y = 0;
  });
}

// Main draw loop
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Background / roads
  for (let row = 0; row < ROWS; row++) {
    ctx.fillStyle = row >= 2 && row <= 7 ? theme().road : theme().goal;
    ctx.fillRect(0, row * TILE, COLS * TILE, TILE);
  }

  // Cars
  cars.forEach(car => {
    ctx.fillStyle = theme().car;
    ctx.fillRect(car.x * TILE, car.row * TILE + 8, TILE - 16, TILE - 16);
  });

  // Robot
  if (state === 'gameover') drawGnome(true);
  else drawGnome(false);

  // Rain
  if (state === 'gameover') drawRain();
}

function update() {
  if (state === 'play') {
    cars.forEach(car => {
      car.x += car.speed;
      if (car.x > COLS) car.x = 0;
      if (car.x < -1) car.x = COLS - 1;

      // Collision check
      if (Math.floor(car.row) === robot.y && Math.abs(car.x - robot.x) < 0.5) {
        loseLife();
      }
    });

    // Check goal
    if (robot.y === 0) completeLevel();
  }
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();

// Simple controls
window.addEventListener('keydown', e => {
  if (state !== 'play') return;
  if (e.key === 'ArrowUp' && robot.y > 0) robot.y--;
  if (e.key === 'ArrowDown' && robot.y < ROWS - 1) robot.y++;
  if (e.key === 'ArrowLeft' && robot.x > 0) robot.x--;
  if (e.key === 'ArrowRight' && robot.x < COLS - 1) robot.x++;
});
</script>
</body>
</html>
